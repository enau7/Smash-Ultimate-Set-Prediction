<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Colton Rowe">

<title>Smash Ultimate Set Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#what-is-smash-ultimate" id="toc-what-is-smash-ultimate" class="nav-link" data-scroll-target="#what-is-smash-ultimate">What is Smash Ultimate?</a></li>
  <li><a href="#statement-of-purpose" id="toc-statement-of-purpose" class="nav-link" data-scroll-target="#statement-of-purpose">Statement of Purpose</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#source" id="toc-source" class="nav-link" data-scroll-target="#source">Source</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data">Missing Data</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data cleaning</a></li>
  <li><a href="#codebook" id="toc-codebook" class="nav-link" data-scroll-target="#codebook">Codebook</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#correlation-matrix" id="toc-correlation-matrix" class="nav-link" data-scroll-target="#correlation-matrix">Correlation Matrix</a></li>
  <li><a href="#games-played-as-skill" id="toc-games-played-as-skill" class="nav-link" data-scroll-target="#games-played-as-skill">“Games Played” as Skill</a></li>
  <li><a href="#win-percent-vs-skill-by-character" id="toc-win-percent-vs-skill-by-character" class="nav-link" data-scroll-target="#win-percent-vs-skill-by-character">Win Percent vs Skill by Character</a></li>
  <li><a href="#distribution-of-games-played" id="toc-distribution-of-games-played" class="nav-link" data-scroll-target="#distribution-of-games-played">Distribution of Games Played</a></li>
  <li><a href="#win-percent-vs-skill-of-specific-matchups" id="toc-win-percent-vs-skill-of-specific-matchups" class="nav-link" data-scroll-target="#win-percent-vs-skill-of-specific-matchups">Win Percent vs Skill of Specific Matchups</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  </ul></li>
  <li><a href="#fitting-models" id="toc-fitting-models" class="nav-link" data-scroll-target="#fitting-models">Fitting Models</a>
  <ul class="collapse">
  <li><a href="#metrics" id="toc-metrics" class="nav-link" data-scroll-target="#metrics">Metrics</a></li>
  <li><a href="#train-test-split" id="toc-train-test-split" class="nav-link" data-scroll-target="#train-test-split">Train / Test Split</a></li>
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning">Hyperparameter Tuning</a></li>
  </ul></li>
  <li><a href="#evaluation" id="toc-evaluation" class="nav-link" data-scroll-target="#evaluation">Evaluation</a>
  <ul class="collapse">
  <li><a href="#metrics-1" id="toc-metrics-1" class="nav-link" data-scroll-target="#metrics-1">Metrics</a></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance">Variable Importance</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Smash Ultimate Set Prediction</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Colton Rowe </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><img src="images/smash_banner.png" title="Smash Ultimate Banner" class="img-fluid"></p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<section id="what-is-smash-ultimate" class="level3">
<h3 class="anchored" data-anchor-id="what-is-smash-ultimate">What is Smash Ultimate?</h3>
<p>Super Smash Bros.&nbsp;Ultimate is the latest installment of Super Smash Bros., a series of competitive multiplayer games by Nintendo. In Super Smash Bros., players pick from a roster of Nintendo characters and duke it out on a 2D platformer-esque stage. In Smash Ultimate, the roster features 87 unique characters, which, in a 2-player game, makes 7569 total match ups. Each character has different fighting stats and abilities, so each match up is unique.</p>
</section>
<section id="statement-of-purpose" class="level3">
<h3 class="anchored" data-anchor-id="statement-of-purpose">Statement of Purpose</h3>
<p>I want to be able to predict the outcome of a match given character data and information about the skill level of the players. I think it will be interesting to see if certain characters are better or worse at different skill levels, and if the stage data is meaningful or makes no difference.</p>
</section>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<section id="source" class="level3">
<h3 class="anchored" data-anchor-id="source">Source</h3>
<p>I sourced my data from <a href="https://smashdata.gg">smashdata.gg</a> through their <a href="https://github.com/smashdata/ThePlayerDatabase">Github</a>. The file I downloaded was <code>ultimate_player_database.zip</code>.</p>
</section>
<section id="missing-data" class="level3">
<h3 class="anchored" data-anchor-id="missing-data">Missing Data</h3>
<p>Fortunately, <a href="https://smashdata.gg">smashdata.gg</a> provides us with some insight on why some data is missing and how it has been handled. They say, “<em>A lot of tournaments also don’t report full data, meaning game counts and character data have been lost.</em>” Character data is our primary focus, but it seems that this is not dependent on the values themselves, just the tournaments they come from. This means we can assume missing data is missing completely at random, meaning it is not dependent of the values themselves nor any other values in the dataset. I’ve decided to remove all the rows where game data is completely absent. If the game data is present but the character data is absent, then I filled in the value for character with <code>-1</code>, indicating this absence.</p>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data cleaning</h3>
<p>The data from <a href="https://smashdata.gg">smashdata.gg</a> first needs to be cleaned in order to be used for modeling.</p>
<p>We are given a database file which contains information about sets, tournaments, players, and so on. I am only interested in the set data, and specifically, the <code>game data</code> column in <code>sets</code>. We are given the game data as a json string, so I will extract this to a dataframe.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> clear_output</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>cnx <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">'data/ultimate_player_database.db'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"SELECT game_data FROM sets WHERE game_data != '[]'"</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql_query(query, cnx)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df)):</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> k <span class="op">%</span> <span class="dv">50000</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        clear_output()</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="sc">{prop}</span><span class="st"> </span><span class="sc">% c</span><span class="st">omplete"</span>.<span class="bu">format</span>(prop <span class="op">=</span> math.floor(<span class="dv">100</span><span class="op">*</span>k<span class="op">/</span><span class="bu">len</span>(df))))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">str</span> <span class="op">=</span> df.loc[k][<span class="dv">0</span>]</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        id1 <span class="op">=</span> <span class="bu">str</span>.find(<span class="st">"{"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        id2 <span class="op">=</span> <span class="bu">str</span>.find(<span class="st">"}"</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (id1 <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span> ) <span class="kw">and</span> (id2 <span class="op">!=</span> <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>            new_data <span class="op">=</span> json.loads(<span class="bu">str</span>[id1:id2<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>            data.append(new_data)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span>  </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span> <span class="op">=</span> <span class="bu">str</span>[id2<span class="op">+</span><span class="dv">1</span>:]</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>game_df <span class="op">=</span> pd.DataFrame(data).fillna(<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>game_df.to_csv(<span class="st">"data/game_data.csv"</span>,index <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>clear_output()</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"100 </span><span class="sc">% c</span><span class="st">omplete"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now I’ll modify the character data so it is easier to read.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>game_df <span class="op">=</span> pd.read_csv(<span class="st">"data/game_data.csv"</span>,dtype<span class="op">=</span>{<span class="st">'winner_id'</span> : <span class="st">"string"</span>, <span class="st">'loser_id'</span> : <span class="st">"string"</span>, <span class="st">'winner_score'</span> : <span class="st">"string"</span>, <span class="st">'loser_score'</span> : <span class="st">"string"</span>,<span class="st">"winner_char"</span> : <span class="st">"string"</span>,<span class="st">"loser_char"</span> : <span class="st">"string"</span>})</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>game_df <span class="op">=</span> game_df.drop(<span class="st">"winner_score"</span>,axis<span class="op">=</span><span class="dv">1</span>).drop(<span class="st">"loser_score"</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>game_df[<span class="st">"winner_char"</span>] <span class="op">=</span> game_df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="st">"winner_char"</span>].replace(<span class="st">"ultimate/"</span>,<span class="st">""</span>),axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>game_df[<span class="st">"loser_char"</span>] <span class="op">=</span> game_df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="st">"loser_char"</span>].replace(<span class="st">"ultimate/"</span>,<span class="st">""</span>),axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We need to transform our data to be impartial to the winner or loser. We now have <code>winner_id</code>, <code>loser_id</code>, <code>winner_char</code>,<code>loser_char</code>, … ect but what we want is <code>p_1_id</code>,<code>p2_id</code>, <code>p1_char</code>,<code>p2_char</code>, <code>p1_won</code>. Otherwise, we wouldn’t be predicting anything because we would know who won beforehand. Let’s transform our data to add our desired columns.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> condswap(b,tup):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># conditional swap</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> b: </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (tup[<span class="dv">1</span>],tup[<span class="dv">0</span>])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> tup</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> row_transform(row):</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    p1w <span class="op">=</span> <span class="bu">bool</span>(random.getrandbits(<span class="dv">1</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    output[<span class="st">"p1_id"</span>], output[<span class="st">"p2_id"</span>] <span class="op">=</span> condswap(<span class="kw">not</span> p1w,(row[<span class="st">"winner_id"</span>],row[<span class="st">"loser_id"</span>]))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    output[<span class="st">"p1_char"</span>], output[<span class="st">"p2_char"</span>] <span class="op">=</span> condswap(<span class="kw">not</span> p1w,(row[<span class="st">"winner_char"</span>],row[<span class="st">"loser_char"</span>]))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    output[<span class="st">"stage"</span>] <span class="op">=</span> row[<span class="st">"stage"</span>]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    output[<span class="st">"p1_won"</span>] <span class="op">=</span> p1w</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">1984</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>game_list <span class="op">=</span> game_df.<span class="bu">apply</span>(row_transform,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>imp_game_df <span class="op">=</span> pd.DataFrame.from_records(game_list)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>imp_game_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I want to add a column that gives information about how many games a player has played and won so we can have a sort of “skill” metric. However, we need to be careful about when we transform our data. If we do it across the entire dataset then, for example, the model could deduce that someone with 0 games won has a 0% chance of winning and get 100% accuracy for those values. Someone with 0 games previously won might have a <em>low</em> chance of winning, but it is certainly not zero. So, I’m going to split the ENTIRE dataset in half, then calculate player ratio and skill from that. Then the <code>games played</code> and <code>games won</code> metrics would be independent of both the training and test, and everything would be MCAR.</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transform_games_played(dataframe):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    p1s <span class="op">=</span> <span class="bu">dict</span>(dataframe[<span class="st">"p1_id"</span>].value_counts())</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    p1wins <span class="op">=</span> <span class="bu">dict</span>(dataframe[dataframe[<span class="st">"p1_won"</span>] <span class="op">==</span> <span class="va">True</span>][<span class="st">"p1_id"</span>].value_counts())</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    p2s <span class="op">=</span> <span class="bu">dict</span>(dataframe[<span class="st">"p2_id"</span>].value_counts())</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    p2wins <span class="op">=</span> <span class="bu">dict</span>(dataframe[dataframe[<span class="st">"p1_won"</span>] <span class="op">==</span> <span class="va">False</span>][<span class="st">"p2_id"</span>].value_counts())</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    players <span class="op">=</span> <span class="bu">set</span>(p1s.keys()).union(<span class="bu">set</span>(p2s.keys()))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    games_played <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> players:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        totalsum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        winsum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> item <span class="kw">in</span> p1s.keys():</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            totalsum <span class="op">+=</span> p1s[item]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> item <span class="kw">in</span> p2s.keys():</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            totalsum <span class="op">+=</span> p2s[item]</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> item <span class="kw">in</span> p1wins.keys():</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            winsum <span class="op">+=</span> p1wins[item]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> item <span class="kw">in</span> p2wins.keys():</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            winsum <span class="op">+=</span> p2wins[item]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        games_played.append({<span class="st">"player_id"</span> : item, <span class="st">"games_played"</span> : totalsum, <span class="st">"games_won"</span> : winsum})</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    games_played_df <span class="op">=</span> pd.DataFrame(games_played)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> games_played_df</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_games(given_df,skill_df):</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    games_played_df <span class="op">=</span> transform_games_played(skill_df)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    output_df <span class="op">=</span> pd.merge(given_df,games_played_df, left_on <span class="op">=</span> <span class="st">"p1_id"</span>, right_on <span class="op">=</span> <span class="st">"player_id"</span>, how <span class="op">=</span> <span class="st">"left"</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    output_df.rename(columns <span class="op">=</span> {<span class="st">"games_played"</span> : <span class="st">"p1_games_played"</span>, <span class="st">"games_won"</span> : <span class="st">"p1_games_won"</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    output_df <span class="op">=</span> pd.merge(output_df,games_played_df, left_on <span class="op">=</span> <span class="st">"p2_id"</span>, right_on <span class="op">=</span> <span class="st">"player_id"</span>, how <span class="op">=</span> <span class="st">"left"</span>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    output_df.rename(columns <span class="op">=</span> {<span class="st">"games_played"</span> : <span class="st">"p2_games_played"</span>, <span class="st">"games_won"</span> : <span class="st">"p2_games_won"</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    output_df[<span class="st">"p1_games_won"</span>].fillna(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    output_df[<span class="st">"p1_games_played"</span>].fillna(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    output_df[<span class="st">"p2_games_won"</span>].fillna(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    output_df[<span class="st">"p2_games_played"</span>].fillna(<span class="dv">0</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    output_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    output_df.drop(columns<span class="op">=</span>[<span class="st">"index"</span>,<span class="st">"player_id_x"</span>,<span class="st">"player_id_y"</span>],inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output_df</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>_skill_df <span class="op">=</span> imp_game_df.sample(frac <span class="op">=</span> <span class="fl">0.5</span>, random_state<span class="op">=</span><span class="dv">2049</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>remaining_df <span class="op">=</span> imp_game_df.drop(_skill_df.index)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>clean_game_df <span class="op">=</span> clean_games(remaining_df,_skill_df) <span class="co"># The output rows are independent of the games played and won.</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>skill_clean_game_df <span class="op">=</span> clean_games(_skill_df,_skill_df) <span class="co"># The output rows are NOT independent of the games played and won.</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>clean_game_df.to_csv(<span class="st">"data/clean_game_data.csv"</span>,index<span class="op">=</span><span class="va">False</span>) <span class="co"># To be used for training/test.</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>skill_clean_game_df.to_csv(<span class="st">"data/dependent_skill_data.csv"</span>,index <span class="op">=</span> <span class="va">False</span>) <span class="co"># To be used in case we want to create more metrics.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can now better use our data for fitting models.</p>
</section>
<section id="codebook" class="level3">
<h3 class="anchored" data-anchor-id="codebook">Codebook</h3>
<p>This codebook identifies each of the variables in <code>cleaned_game_data.csv</code>.</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>p1_id</code></td>
<td>A string identifying the first player.</td>
</tr>
<tr class="even">
<td><code>p2_id</code></td>
<td>A string identifying the second player.</td>
</tr>
<tr class="odd">
<td><code>p1_games_played</code></td>
<td>An integer indicating how many games the first player has played in <code>dependent_skill_data.csv</code>.</td>
</tr>
<tr class="even">
<td><code>p2_games_played</code></td>
<td>An integer indicating how many games the second player has played in <code>dependent_skill_data.csv</code>.</td>
</tr>
<tr class="odd">
<td><code>p1_games_won</code></td>
<td>An integer indicating how many games the first player has won in <code>dependent_skill_data.csv</code>.</td>
</tr>
<tr class="even">
<td><code>p1_games_won</code></td>
<td>An integer indicating how many games the second player has won in <code>dependent_skill_data.csv</code>.</td>
</tr>
<tr class="odd">
<td><code>p1_char</code></td>
<td>A string indicating the character of the first player.</td>
</tr>
<tr class="even">
<td><code>p2_char</code></td>
<td>A string indicating the character of the second player.</td>
</tr>
<tr class="odd">
<td><code>stage</code></td>
<td>A string identifying the stage the match was played on.</td>
</tr>
<tr class="even">
<td><code>p1_won</code></td>
<td>A boolean indicating if the first player won.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<p>First, let’s load our data in.</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>game_df <span class="op">=</span> pd.read_csv(<span class="st">"../Data/data/clean_game_data.csv"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>skill_data <span class="op">=</span> pd.read_csv(<span class="st">"../Data/data/dependent_skill_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="correlation-matrix" class="level3">
<h3 class="anchored" data-anchor-id="correlation-matrix">Correlation Matrix</h3>
<p>Let’s start by plotting a correlation matrix between our numeric variables.</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> game_df.corr()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>corr.style.background_gradient(cmap<span class="op">=</span><span class="st">'coolwarm'</span>).set_precision(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">

<style type="text/css">
#T_64796_row0_col0,#T_64796_row1_col1,#T_64796_row2_col2,#T_64796_row3_col3,#T_64796_row4_col4{
            background-color:  #b40426;
            color:  #f1f1f1;
        }#T_64796_row0_col1,#T_64796_row0_col2,#T_64796_row0_col3,#T_64796_row0_col4,#T_64796_row4_col0{
            background-color:  #3b4cc0;
            color:  #f1f1f1;
        }#T_64796_row1_col0{
            background-color:  #7b9ff9;
            color:  #000000;
        }#T_64796_row1_col2,#T_64796_row2_col1,#T_64796_row3_col4,#T_64796_row4_col3{
            background-color:  #b70d28;
            color:  #f1f1f1;
        }#T_64796_row1_col3{
            background-color:  #92b4fe;
            color:  #000000;
        }#T_64796_row1_col4{
            background-color:  #94b6ff;
            color:  #000000;
        }#T_64796_row2_col0{
            background-color:  #7ea1fa;
            color:  #000000;
        }#T_64796_row2_col3{
            background-color:  #93b5fe;
            color:  #000000;
        }#T_64796_row2_col4{
            background-color:  #97b8ff;
            color:  #000000;
        }#T_64796_row3_col0{
            background-color:  #3c4ec2;
            color:  #f1f1f1;
        }#T_64796_row3_col1,#T_64796_row3_col2{
            background-color:  #5470de;
            color:  #000000;
        }#T_64796_row4_col1{
            background-color:  #5572df;
            color:  #000000;
        }#T_64796_row4_col2{
            background-color:  #5673e0;
            color:  #000000;
        }</style><table id="T_64796_"><thead>    <tr>        <th class="blank level0"></th>        <th class="col_heading level0 col0">p1_won</th>        <th class="col_heading level0 col1">p1_games_played</th>        <th class="col_heading level0 col2">p1_games_won</th>        <th class="col_heading level0 col3">p2_games_played</th>        <th class="col_heading level0 col4">p2_games_won</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_64796_level0_row0" class="row_heading level0 row0">p1_won</th>
                        <td id="T_64796_row0_col0" class="data row0 col0">1.00</td>
                        <td id="T_64796_row0_col1" class="data row0 col1">0.11</td>
                        <td id="T_64796_row0_col2" class="data row0 col2">0.12</td>
                        <td id="T_64796_row0_col3" class="data row0 col3">-0.11</td>
                        <td id="T_64796_row0_col4" class="data row0 col4">-0.12</td>
            </tr>
            <tr>
                        <th id="T_64796_level0_row1" class="row_heading level0 row1">p1_games_played</th>
                        <td id="T_64796_row1_col0" class="data row1 col0">0.11</td>
                        <td id="T_64796_row1_col1" class="data row1 col1">1.00</td>
                        <td id="T_64796_row1_col2" class="data row1 col2">0.99</td>
                        <td id="T_64796_row1_col3" class="data row1 col3">0.18</td>
                        <td id="T_64796_row1_col4" class="data row1 col4">0.19</td>
            </tr>
            <tr>
                        <th id="T_64796_level0_row2" class="row_heading level0 row2">p1_games_won</th>
                        <td id="T_64796_row2_col0" class="data row2 col0">0.12</td>
                        <td id="T_64796_row2_col1" class="data row2 col1">0.99</td>
                        <td id="T_64796_row2_col2" class="data row2 col2">1.00</td>
                        <td id="T_64796_row2_col3" class="data row2 col3">0.19</td>
                        <td id="T_64796_row2_col4" class="data row2 col4">0.20</td>
            </tr>
            <tr>
                        <th id="T_64796_level0_row3" class="row_heading level0 row3">p2_games_played</th>
                        <td id="T_64796_row3_col0" class="data row3 col0">-0.11</td>
                        <td id="T_64796_row3_col1" class="data row3 col1">0.18</td>
                        <td id="T_64796_row3_col2" class="data row3 col2">0.19</td>
                        <td id="T_64796_row3_col3" class="data row3 col3">1.00</td>
                        <td id="T_64796_row3_col4" class="data row3 col4">0.99</td>
            </tr>
            <tr>
                        <th id="T_64796_level0_row4" class="row_heading level0 row4">p2_games_won</th>
                        <td id="T_64796_row4_col0" class="data row4 col0">-0.12</td>
                        <td id="T_64796_row4_col1" class="data row4 col1">0.19</td>
                        <td id="T_64796_row4_col2" class="data row4 col2">0.20</td>
                        <td id="T_64796_row4_col3" class="data row4 col3">0.99</td>
                        <td id="T_64796_row4_col4" class="data row4 col4">1.00</td>
            </tr>
    </tbody></table>
</div>
</div>
<p>We see that <code>p1_games_played</code> and <code>p2_games_played</code> are correlated, meaning players with more games played are more likely to play against each other. We also see that <code>p1_games_played</code> and <code>p1_won</code> are correlated, so <code>games_played</code> might be a good indicator of skill. Let’s explore this further.</p>
</section>
<section id="games-played-as-skill" class="level3">
<h3 class="anchored" data-anchor-id="games-played-as-skill">“Games Played” as Skill</h3>
<p>I want to establish that <code>games played</code> may be a good indicator of skill. To do this, I’ll ask the question: <em>How likely are you to beat someone who has played at least k times as many games as you?</em></p>
<p>Let’s write some code to figure this out.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> k_times_more_games_win_rate(k, df <span class="op">=</span> game_df):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>( (</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                <span class="bu">len</span>(df[(df[<span class="st">"p1_won"</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (df[<span class="st">"p1_games_played"</span>] <span class="op">&gt;</span> k<span class="op">*</span>df[<span class="st">"p2_games_played"</span>])]) <span class="op">+</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                <span class="bu">len</span>(df[(df[<span class="st">"p1_won"</span>] <span class="op">==</span> <span class="va">False</span>) <span class="op">&amp;</span> (df[<span class="st">"p2_games_played"</span>] <span class="op">&gt;</span> k<span class="op">*</span>df[<span class="st">"p1_games_played"</span>])])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            ) <span class="op">/</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                <span class="bu">len</span>(df[(df[<span class="st">"p1_games_played"</span>] <span class="op">&gt;</span> k<span class="op">*</span>df[<span class="st">"p2_games_played"</span>])]) <span class="op">+</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                <span class="bu">len</span>(df[(df[<span class="st">"p2_games_played"</span>] <span class="op">&gt;</span> k<span class="op">*</span>df[<span class="st">"p1_games_played"</span>])])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> [k_times_more_games_win_rate(n<span class="op">/</span><span class="dv">4</span>) <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>,<span class="dv">40</span>)]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>plt.plot([(n<span class="op">/</span><span class="dv">4</span>) <span class="cf">for</span> n <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>,<span class="dv">40</span>)],graph)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"k"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Chance of winning"</span>) </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Chance of winning given a player has played at least k times as many games as their opponent"</span>) </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(k_times_more_games_win_rate(<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-8-output-1.png" width="786" height="449"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>0.6192630428086423</code></pre>
</div>
</div>
<p>This graph justifies the belief that games played is a metric of skill level, because someone with more games played has a higher chance of winning.</p>
</section>
<section id="win-percent-vs-skill-by-character" class="level3">
<h3 class="anchored" data-anchor-id="win-percent-vs-skill-by-character">Win Percent vs Skill by Character</h3>
<p>I suspect that character win rate might change depending on how skilled a player is. For example, maybe <code>kirby</code> is a really good character until you get to a certain level, at which point they are less viable.</p>
<p>Let’s define some functions that will help us graph <code>win chance</code> against <code>games played</code>.</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> win_percent(df):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (df[df[<span class="st">"p1_won"</span>] <span class="op">==</span> <span class="va">True</span>][<span class="st">"p1_char"</span>].value_counts() <span class="op">+</span> df[df[<span class="st">"p1_won"</span>] <span class="op">==</span> <span class="va">False</span>][<span class="st">"p2_char"</span>].value_counts()) <span class="op">/</span> <span class="op">\</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>              (df[<span class="st">"p2_char"</span>].value_counts() <span class="op">+</span> df[<span class="st">"p1_char"</span>].value_counts())</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> level_win_percent(df,level,step):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> win_percent(df[</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">"p1_games_played"</span>] <span class="op">&gt;=</span> level) <span class="op">&amp;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">"p1_games_played"</span>] <span class="op">&lt;</span> level <span class="op">+</span> step) </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        ) <span class="op">|</span> (</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">"p2_games_played"</span>] <span class="op">&gt;=</span> level) <span class="op">&amp;</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        (df[<span class="st">"p2_games_played"</span>] <span class="op">&lt;</span> level <span class="op">+</span> step)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        ]).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> chargraph(characters, start <span class="op">=</span> <span class="dv">0</span>, stop <span class="op">=</span> <span class="dv">1000</span>, step <span class="op">=</span> <span class="dv">50</span>, df <span class="op">=</span> game_df):</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">type</span>(characters) <span class="op">==</span> <span class="bu">str</span>:</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        characters <span class="op">=</span> [characters]</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    graph <span class="op">=</span> {char : <span class="bu">list</span>() <span class="cf">for</span> char <span class="kw">in</span> characters}</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(start,stop,step):</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        LWP <span class="op">=</span> level_win_percent(df,k,step)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> char <span class="kw">in</span> characters:</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> char <span class="kw">in</span> LWP.index:</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                graph[char].append(LWP[char])</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                graph[char].append(np.NaN)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> graph.keys():</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        output, <span class="op">=</span> plt.plot(<span class="bu">range</span>(start,stop,step), graph[key], label <span class="op">=</span> key)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"p1 or p2 games played"</span>)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Chance of winning"</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And now let’s plot some of these graphs.</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>chargraph([<span class="st">"ness"</span>,<span class="st">"samus"</span>,<span class="st">"luigi"</span>,<span class="st">"joker"</span>],stop <span class="op">=</span> <span class="dv">3000</span>, step <span class="op">=</span> <span class="dv">250</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-10-output-1.png" width="597" height="429"></p>
</div>
</div>
<p>We see that the variance of these lines increases with games played, likely because there are less players with many games played. We can decipher some trends in these lines visually, like how the mean of Ness and Luigi’s win rate stays relatively constant, though the mean of Joker and Samus’s seem to decrease. This supports our hypothesis that <code>win percent</code> is not constant with respect to skill.</p>
</section>
<section id="distribution-of-games-played" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-games-played">Distribution of Games Played</h3>
<p>Let’s verify that there are less players with many games played.</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> skill_data[[<span class="st">"p1_id"</span>,<span class="st">"p1_games_played"</span>]].rename(columns <span class="op">=</span> {<span class="st">"p1_id"</span> : <span class="st">"player_id"</span>,<span class="st">"p1_games_played"</span> : <span class="st">"player_games_played"</span>})</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> skill_data[[<span class="st">"p2_id"</span>,<span class="st">"p2_games_played"</span>]].rename(columns <span class="op">=</span> {<span class="st">"p2_id"</span> : <span class="st">"player_id"</span>,<span class="st">"p2_games_played"</span> : <span class="st">"player_games_played"</span>})</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>player_games_played_df <span class="op">=</span> df1.append(df2,ignore_index <span class="op">=</span> <span class="va">True</span>).astype({<span class="st">"player_id"</span> : <span class="st">"string"</span>, <span class="st">"player_games_played"</span> : <span class="st">"int32"</span>}).drop_duplicates(ignore_index<span class="op">=</span><span class="va">True</span>).sort_values(<span class="st">"player_games_played"</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>plt.hist(player_games_played_df[<span class="st">"player_games_played"</span>].to_list(),bins<span class="op">=</span><span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="dv">5</span>))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of games played"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"count"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"games played"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.hist(player_games_played_df[player_games_played_df["player_games_played"] &gt;= 200]["player_games_played"].to_list(),bins=range(200,2000,50))</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.show() - has same 1/x graph</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-11-output-1.png" width="611" height="449"></p>
</div>
</div>
<p>We can see that there are far less players with many games played than with few games played.</p>
</section>
<section id="win-percent-vs-skill-of-specific-matchups" class="level3">
<h3 class="anchored" data-anchor-id="win-percent-vs-skill-of-specific-matchups">Win Percent vs Skill of Specific Matchups</h3>
<p>Finally, I want to look at how the win percents of a matchup of two characters changes with respect to <code>games played</code>.</p>
<p>I’ll modify our previous functions and plot a graph of the win ratios of <code>pikachu</code> versus <code>ganondorf</code>.</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vs_df(char1, char2):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> game_df[((game_df[<span class="st">"p1_char"</span>] <span class="op">==</span> char1) <span class="op">&amp;</span> (game_df[<span class="st">"p2_char"</span>] <span class="op">==</span> char2)) <span class="op">|</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                    ((game_df[<span class="st">"p2_char"</span>] <span class="op">==</span> char1) <span class="op">&amp;</span> (game_df[<span class="st">"p1_char"</span>] <span class="op">==</span> char2))]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vsgraph(char1, char2, start <span class="op">=</span> <span class="dv">0</span>, stop <span class="op">=</span> <span class="dv">1500</span>, step <span class="op">=</span> <span class="dv">250</span>):</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    chargraph(char1,df<span class="op">=</span>vs_df(char1,char2),start<span class="op">=</span>start, stop<span class="op">=</span>stop, step<span class="op">=</span>step).set_label(char1 <span class="op">+</span> <span class="st">" win percentage vs "</span> <span class="op">+</span> char2)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>vsgraph(<span class="st">"pikachu"</span>,<span class="st">"ganondorf"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>vsgraph(<span class="st">"ganondorf"</span>,<span class="st">"pikachu"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-12-output-1.png" width="606" height="429"></p>
</div>
</div>
<p>Again, we see that the win percentage changes as a function of the skill level of the players.</p>
</section>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<p>We’ve now gathered sufficient information about the relationships between our variables, and have a better idea about which models we can use for fitting our data. It seems as though <code>games played</code> and <code>games won</code> will likely fit a logistic regression, but other variables such as the character data might be need more flexible models.</p>
</section>
</section>
<section id="fitting-models" class="level2">
<h2 class="anchored" data-anchor-id="fitting-models">Fitting Models</h2>
<section id="metrics" class="level3">
<h3 class="anchored" data-anchor-id="metrics">Metrics</h3>
<p>For classification problems, the two metrics to focus on are accuracy and the area under the ROC curve. In general it is better to use <code>roc_auc</code> because it accounts for class imbalances, however it is more difficult to visualize than accuracy. Because I randomized <code>p1_won</code> when I transformed the data, there is no class imbalance present. Because of this, for hyperparameter tuning I’m going to score by accuracy as accuracy is much easier to interpret. Let’s verify that there is no class imbalance:</p>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plt.bar(x <span class="op">=</span> [<span class="va">True</span>, <span class="va">False</span>], height <span class="op">=</span> game_df[<span class="st">"p1_won"</span>].value_counts() <span class="op">/</span> <span class="bu">len</span>(game_df))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="va">True</span>, <span class="va">False</span>], [<span class="st">"True"</span>, <span class="st">"False"</span>])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"p1_won True vs False"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-13-output-1.png" width="571" height="431"></p>
</div>
</div>
<p>We can see that there are equal proportions of <code>True</code> and <code>False</code> in <code>p1_won</code>, so there isn’t any class imbalance.</p>
</section>
<section id="train-test-split" class="level3">
<h3 class="anchored" data-anchor-id="train-test-split">Train / Test Split</h3>
<p>First, let’s load in our data:</p>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> ensemble</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> StratifiedKFold</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>game_data <span class="op">=</span> pd.read_csv(<span class="st">"../Data/data/clean_game_data.csv"</span>,dtype<span class="op">=</span>{<span class="st">"p1_id"</span> : <span class="st">"string"</span>,<span class="st">"p2_id"</span> : <span class="st">"string"</span>,<span class="st">"p1_char"</span> : <span class="st">"string"</span>, <span class="st">"p2_char"</span> : <span class="st">"string"</span>, <span class="st">"stage"</span> : <span class="st">"string"</span>, <span class="st">"p1_games_played"</span> : <span class="st">"int32"</span>, <span class="st">"p1_games_won"</span> : <span class="st">"int32"</span>, <span class="st">"p2_games_played"</span> : <span class="st">"int32"</span>, <span class="st">"p2_games_won"</span> : <span class="st">"int32"</span>, <span class="st">"p1_won"</span> : <span class="st">"bool"</span>})</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>game_data <span class="op">=</span> pd.get_dummies(game_data, columns<span class="op">=</span>[<span class="st">"p1_char"</span>,<span class="st">"p2_char"</span>,<span class="st">"stage"</span>], prefix_sep<span class="op">=</span><span class="st">"."</span>, )</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>game_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>p1_id</th>
      <th>p2_id</th>
      <th>p1_won</th>
      <th>p1_games_played</th>
      <th>p1_games_won</th>
      <th>p2_games_played</th>
      <th>p2_games_won</th>
      <th>p1_char.-1</th>
      <th>p1_char.banjokazooie</th>
      <th>p1_char.bayonetta</th>
      <th>...</th>
      <th>stage.Town and City</th>
      <th>stage.Unova Pokemon League</th>
      <th>stage.Unova Pokémon League</th>
      <th>stage.Venom</th>
      <th>stage.WarioWare</th>
      <th>stage.Wily Castle</th>
      <th>stage.Yggdrasil's Altar</th>
      <th>stage.Yoshi's Island</th>
      <th>stage.Yoshi's Island (Melee)</th>
      <th>stage.Yoshi's Story</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1472816</td>
      <td>1075251</td>
      <td>False</td>
      <td>2</td>
      <td>0</td>
      <td>23</td>
      <td>13</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1075251</td>
      <td>1472816</td>
      <td>True</td>
      <td>23</td>
      <td>13</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>challonge__MrRiceman</td>
      <td>challonge__Loconotcoco</td>
      <td>False</td>
      <td>4</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Leo</td>
      <td>1272809</td>
      <td>True</td>
      <td>1</td>
      <td>1</td>
      <td>102</td>
      <td>49</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1034645</td>
      <td>1302612</td>
      <td>True</td>
      <td>77</td>
      <td>40</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2963854</th>
      <td>30896</td>
      <td>4702</td>
      <td>False</td>
      <td>72</td>
      <td>51</td>
      <td>865</td>
      <td>555</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2963855</th>
      <td>4702</td>
      <td>30896</td>
      <td>True</td>
      <td>865</td>
      <td>555</td>
      <td>72</td>
      <td>51</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2963856</th>
      <td>1263104</td>
      <td>53481</td>
      <td>True</td>
      <td>186</td>
      <td>112</td>
      <td>8</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2963857</th>
      <td>53481</td>
      <td>1263104</td>
      <td>False</td>
      <td>8</td>
      <td>7</td>
      <td>186</td>
      <td>112</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2963858</th>
      <td>230918</td>
      <td>30044</td>
      <td>False</td>
      <td>212</td>
      <td>120</td>
      <td>79</td>
      <td>53</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2963859 rows × 237 columns</p>
</div>
</div>
</div>
<p>I dummy-coded some of the categorical variables right away so the data is easier to use.</p>
<p>We need to split our data into a testing set and a training set so we can train our models and evaluate their accuracy. I am going to use a 4:1 ratio, and stratify across our response variable <code>p1_won</code>, so we don’t develop any unexpected imbalances across our training and testing environments.</p>
<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>game_train, game_test <span class="op">=</span> train_test_split(game_data, train_size <span class="op">=</span> <span class="fl">0.8</span>, stratify <span class="op">=</span> game_data[[<span class="st">"p1_won"</span>]], random_state<span class="op">=</span><span class="dv">2049</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We stratified on our response, p1_won. </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This shouldn't make too much of a difference because we randomized which is p1 and p2, however it is still good practice.</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> game_train.loc[:,game_train.columns <span class="op">!=</span> <span class="st">"p1_won"</span>]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> game_train[<span class="st">"p1_won"</span>]</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>game_folded <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>).split(X,y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="hyperparameter-tuning" class="level3">
<h3 class="anchored" data-anchor-id="hyperparameter-tuning">Hyperparameter Tuning</h3>
<p>The following block of code will make it easier to save and load models.</p>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fitmodel(model, filename, df <span class="op">=</span> game_train):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isfile(filename):</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        model.fit(X,y)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        joblib.dump(model, filename)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        modeltemp <span class="op">=</span> joblib.load(filename)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="bu">type</span>(model) <span class="op">!=</span> <span class="bu">type</span>(modeltemp)) <span class="kw">or</span> <span class="op">\</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            (<span class="bu">tuple</span>([k[<span class="dv">0</span>] <span class="cf">for</span> k <span class="kw">in</span> model.steps]) <span class="op">!=</span> <span class="bu">tuple</span>([k[<span class="dv">0</span>] <span class="cf">for</span> k <span class="kw">in</span> modeltemp.steps])):</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span> (<span class="st">"</span><span class="ch">\033</span><span class="st">[93m Warning: model mismatch. Delete the file </span><span class="sc">{filename}</span><span class="st"> and rerun or risk faulty models.</span><span class="ch">\n</span><span class="st"> </span><span class="ch">\033</span><span class="st">[0m"</span>.<span class="bu">format</span>(filename<span class="op">=</span>filename))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> modeltemp</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="elastic-net" class="level4">
<h4 class="anchored" data-anchor-id="elastic-net">Elastic Net</h4>
<p>In <code>sklearn</code>, there aren’t recipes. Instead, there are pipelines, which works a bit like a recipe and a workflow combined. We can apply transformations to our data including selecting predictors, normalizing variables, and adding models.</p>
<p>To find the best hyperparameters for our models, our first step is to set up a pipeline. Let’s begin by setting up a pipeline for an elastic net.</p>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>en_predictors <span class="op">=</span> [<span class="st">"p1_games_played"</span>,<span class="st">"p2_games_played"</span>,<span class="st">"p1_games_won"</span>,<span class="st">"p2_games_won"</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>en_pipe <span class="op">=</span> Pipeline(steps <span class="op">=</span> [</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"predictors"</span>, ColumnTransformer([(<span class="st">"predictors"</span>,<span class="st">"passthrough"</span>,en_predictors)])),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"logistic"</span>, linear_model.LogisticRegression(solver<span class="op">=</span><span class="st">'saga'</span>,penalty<span class="op">=</span><span class="st">'elasticnet'</span>))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I’ve only selected <code>games played</code> and <code>games won</code> for this model, because for the other predictors such as <code>character</code> to be useful, we would need to add interaction terms. To add interaction terms, we would use <code>sklearn.preprocessing.PolynomialFeatures</code> as a step in our pipeline. However, because there are so many characters, my computer runs out of memory when adding these terms. Regardless, an elastic net is probably not the best way to deal with these interactions anyway - a more flexible model like a decision tree or random forest can automatically find interactions between variables. Let’s wait to use a different model before adding these predictors.</p>
<p>Our next step is to create a grid of hyperparameters we want to check. For an elastic net, I’ve chosen to tune <code>l1_ratio</code> and <code>C</code>. <code>C</code> controls the penalty strength of the elastic net, and <code>l1_ratio</code> controls the ratio of <code>l1</code> to <code>l2</code> in the elastic net, in other words, how similar the elastic net is to a lasso regression versus a ridge regression. <code>l1_ratio</code> thus takes values between <code>0.0</code> and <code>1.0</code>, while <code>C</code> can take on any non-negative value.</p>
<div class="cell" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>en_grid <span class="op">=</span> <span class="bu">dict</span>(logistic__l1_ratio <span class="op">=</span> [<span class="fl">0.0</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>, <span class="fl">1.0</span>],</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>               logistic__C <span class="op">=</span> [<span class="dv">1000</span>, <span class="dv">100</span>, <span class="dv">10</span>, <span class="fl">1.0</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Lastly, we try each combination of variables and pick the model with the best cross validation score. We are going to fold our data with <code>k = 5</code>, and take the average cross-validated score for each combination of hyperparameters. We will then select the highest average score across all hyperparameter combinations.</p>
<div class="cell" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>game_folded <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>).split(X,y)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>en_grid_search <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> en_pipe,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                            param_grid <span class="op">=</span> en_grid,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                            n_jobs <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                            cv <span class="op">=</span> game_folded,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                            scoring <span class="op">=</span> <span class="st">'accuracy'</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                            error_score <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                            verbose <span class="op">=</span> <span class="dv">4</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>en_grid_result <span class="op">=</span> en_grid_search.fit(X[en_predictors],y) <span class="co"># We pass in X[en_predictors] because the result is the same but slightly faster.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Running this code, we find that the best combination of hyperparameters across our search is with <code>l1 = 1.0</code> and <code>C = 0.01</code>. This has a cross-validated accuracy of 0.643, which is a good start.</p>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>en_pipe.set_params(logistic__C <span class="op">=</span> <span class="fl">0.01</span>, logistic__l1_ratio <span class="op">=</span> <span class="fl">1.0</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>en <span class="op">=</span> fitmodel(model <span class="op">=</span> en_pipe,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>              filename <span class="op">=</span> <span class="st">"models/elastic_net.joblib"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="decision-tree" class="level4">
<h4 class="anchored" data-anchor-id="decision-tree">Decision Tree</h4>
<p>We perform a similar process as in the elastic net for each of our models. This time, we’re also going to use character and stage data as predictors, and for hyperparameters, we are going to tune <code>max_depth</code> and <code>min_samples_leaf</code>. Both <code>max_depth</code> and <code>min_samples_leaf</code> help with overfitting, which is a big problem in decision trees. <code>max_depth</code> controls the maximum depth of the decision tree, and <code>min_samples_leaf</code> controls the minimum number of samples required to be at a leaf node.</p>
<div class="cell" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dtc_predictors <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(game_train.head()).difference({<span class="st">"p1_won"</span>,<span class="st">"p1_id"</span>,<span class="st">"p2_id"</span>}))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>dtc_pipe <span class="op">=</span> Pipeline(steps <span class="op">=</span> [</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"predictors"</span>, ColumnTransformer([(<span class="st">"predictors"</span>,<span class="st">"passthrough"</span>,dtc_predictors)])),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"decision_tree"</span>, tree.DecisionTreeClassifier(random_state <span class="op">=</span> <span class="dv">42</span>))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>dtc_grid <span class="op">=</span> <span class="bu">dict</span>(decision_tree__max_depth <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="va">None</span>],</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                decision_tree__min_samples_leaf <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>game_folded <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>).split(X,y)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>dtc_grid_search <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> dtc_pipe,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                               param_grid <span class="op">=</span> dtc_grid,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                               n_jobs <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                               cv <span class="op">=</span> game_folded,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                               scoring <span class="op">=</span> <span class="st">'accuracy'</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                               error_score <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                               verbose <span class="op">=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We find that the best <code>max_depth</code> is 10, and the best <code>min_samples_leaf</code> is also 10. Our cross-validated accuracy is 0.647, so this model performs similar to our elastic net. Let’s fit our model and continue.</p>
<div class="cell" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dtc_pipe.set_params(decision_tree__max_features <span class="op">=</span> <span class="va">None</span>, decision_tree__max_depth <span class="op">=</span> <span class="dv">10</span>, decision_tree__min_samples_leaf <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>dtc <span class="op">=</span> fitmodel(model <span class="op">=</span> dtc_pipe,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>               filename <span class="op">=</span> <span class="st">"models/decision_tree.joblib"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="random-forest" class="level4">
<h4 class="anchored" data-anchor-id="random-forest">Random Forest</h4>
<p>Again, we repeat our process. A random forest is like modeling many decision trees at once, so some of the hyperparameters are the same. For a random forest, I am going to tune the hyperparameters <code>n_estimators</code> and <code>min_samples_leaf</code>, because I found that <code>min_samples_leaf</code> made the biggest difference in the decision tree, and <code>n_estimators</code>, the number of trees in the random forest, can make a big difference on the performance.</p>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>rfc_predictors <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(game_train.head()).difference({<span class="st">"p1_won"</span>,<span class="st">"p1_id"</span>,<span class="st">"p2_id"</span>}))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>rfc_pipe <span class="op">=</span> Pipeline(steps <span class="op">=</span> [</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"predictors"</span>, ColumnTransformer([(<span class="st">"predictors"</span>,<span class="st">"passthrough"</span>,rfc_predictors)])),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"random_forest"</span>, ensemble.RandomForestClassifier(verbose <span class="op">=</span> <span class="dv">3</span>, n_jobs <span class="op">=</span> <span class="dv">4</span>, random_state <span class="op">=</span> <span class="dv">420</span>))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>rfc_grid <span class="op">=</span> <span class="bu">dict</span>(random_forest__n_estimators <span class="op">=</span> [<span class="dv">100</span>,<span class="dv">200</span>,<span class="dv">400</span>],</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                random_forest__min_samples_leaf <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>game_folded <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">2</span>).split(X,y) <span class="co"># 5 folds takes a LONG time to run...</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>rfc_grid_search <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> rfc_pipe,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                               param_grid <span class="op">=</span> rfc_grid,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                               n_jobs <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                               cv <span class="op">=</span> game_folded,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                               scoring <span class="op">=</span> <span class="st">'accuracy'</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                               error_score <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                               verbose <span class="op">=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Despite 400 trees having the highest mean test score, it is only by .00035, and is computationally twice as expensive as 200 trees, which itself is only higher than 100 trees by .0007. We can always use a higher number of trees to get a marginally better test score, so with discretion, I am going to use 200 trees with min_samples_leaf = 3.</p>
<p>So we get a cross-validation score of 0.673 for our random forest with 200 trees and <code>min_samples_leaf</code> = 3. This is around 3 percent better than our previous models!</p>
<p>Let’s fit and store our random forest.</p>
<div class="cell" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rfc_pipe.set_params(random_forest__n_estimators <span class="op">=</span> <span class="dv">200</span>, random_forest__min_samples_leaf <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>rfc <span class="op">=</span> fitmodel(model <span class="op">=</span> rfc_pipe,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>               filename <span class="op">=</span> <span class="st">"models/random_forest.joblib"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="boosted-tree" class="level4">
<h4 class="anchored" data-anchor-id="boosted-tree">Boosted Tree</h4>
<p>Our last model I want to fit is a boosted tree. For this model, I would like to tune <code>max_depth</code> and <code>min_samples_leaf</code>, as well as <code>learning_rate</code> and <code>n_estimators</code>. These are a lot of hyperparameters, and a boosted tree is one of the longest models to fit. As we have it now, if I had 4 levels for each of these parameters, <code>GridSearchCV.fit</code> would take around 174 hours to run, which is over a week.</p>
<p>To get around this, I am going to reduce the size of the dataset I am tuning over. This isn’t ideal, because all of these parameters could depend on the size of the dataset, but in our case, we don’t have many options.</p>
<p>Before fitting our chose model, I’ll also cross-validate it separately with the full dataset, as the cross-validation from the hyperparameter tuning won’t reflect our true chosen model.</p>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>train_sample <span class="op">=</span> game_train.sample(<span class="dv">50000</span>, random_state<span class="op">=</span> <span class="dv">49</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>X_sample <span class="op">=</span> train_sample.loc[:,game_train.columns <span class="op">!=</span> <span class="st">"p1_won"</span>]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>y_sample <span class="op">=</span> train_sample[<span class="st">"p1_won"</span>]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>gbc_predictors <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(game_train.head()).difference({<span class="st">"p1_won"</span>,<span class="st">"p1_id"</span>,<span class="st">"p2_id"</span>}))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>gbc_pipe <span class="op">=</span> rfc_pipe <span class="op">=</span> Pipeline(steps <span class="op">=</span> [</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"predictors"</span>, ColumnTransformer([(<span class="st">"predictors"</span>,<span class="st">"passthrough"</span>,gbc_predictors)])),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"boosted_tree"</span>, ensemble.GradientBoostingClassifier(verbose <span class="op">=</span> <span class="dv">1</span>, n_estimators <span class="op">=</span> <span class="dv">100</span>, random_state <span class="op">=</span> <span class="dv">21</span>))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>            ])</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>gbc_grid <span class="op">=</span> <span class="bu">dict</span>(boosted_tree__n_estimators <span class="op">=</span> [<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>],</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>                boosted_tree__max_depth <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>],</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                boosted_tree__min_samples_leaf <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>],</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                boosted_tree__learning_rate <span class="op">=</span> [<span class="fl">.001</span>, <span class="fl">.01</span>, <span class="fl">.1</span>, <span class="fl">.2</span>]</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>game_folded <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">2</span>).split(X_sample,y_sample)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>gbc_grid_search <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> gbc_pipe,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                               param_grid <span class="op">=</span> gbc_grid,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>                               n_jobs <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>                               cv <span class="op">=</span> game_folded,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>                               scoring <span class="op">=</span> <span class="st">'accuracy'</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>                               error_score <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                               verbose <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>gbc_grid_result <span class="op">=</span> gbc_grid_search.fit(X_sample,y_sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We find that the best set of hyperparameters is <code>n_estimators</code> = 500, <code>learning_rate</code> = 0.2, <code>min_samples_leaf</code> = 3, <code>max_depth</code> = 2, with an accuracy of 0.66928.</p>
<p>To find the true cross-validated accuracy of this model, we can cross-valdate with the entire dataset.</p>
<div class="cell" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>gbc_pipe.set_params(boosted_tree__max_depth <span class="op">=</span> <span class="dv">2</span>, boosted_tree__n_estimators <span class="op">=</span> <span class="dv">500</span>, boosted_tree__learning_rate <span class="op">=</span> <span class="fl">0.2</span>, boosted_tree__min_samples_leaf <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>game_folded <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>).split(X,y)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>cross_val_score(estimator <span class="op">=</span> gbc_pipe,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                n_jobs <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                cv <span class="op">=</span> game_folded,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                X <span class="op">=</span> X,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                y <span class="op">=</span> y,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                scoring <span class="op">=</span> <span class="st">'accuracy'</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                error_score <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                verbose <span class="op">=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And we find that the model has a cross-validation accuracy of 0.680, our best accuracy yet.</p>
</section>
</section>
</section>
<section id="evaluation" class="level2">
<h2 class="anchored" data-anchor-id="evaluation">Evaluation</h2>
<p>Let’s set up and load our best models in. I want to look at the random forest classifier and the elastic net. The random forest classifier did almost as good as the boosted tree in cross-validation (0.007 difference), and contains information about variable importance, which I want to analyze and interpret. The elastic net provides a good baseline for what we should expect from our model, and lets us more deeply analyze how our numerical predictors effect outcome.</p>
<div class="cell" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>game_train, game_test <span class="op">=</span> train_test_split(game_data, train_size <span class="op">=</span> <span class="fl">0.8</span>, stratify <span class="op">=</span> game_data[[<span class="st">"p1_won"</span>]], random_state<span class="op">=</span><span class="dv">2049</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> game_train.loc[:,game_train.columns <span class="op">!=</span> <span class="st">"p1_won"</span>]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> game_train[<span class="st">"p1_won"</span>]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> game_test.loc[:,game_train.columns <span class="op">!=</span> <span class="st">"p1_won"</span>]</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> game_test[<span class="st">"p1_won"</span>]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We use the same seed so that we get the same testing data as in our model_fitting file. This is important for evaluation.</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>en <span class="op">=</span> joblib.load(<span class="st">"../Prediction/models/elastic_net.joblib"</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>rfc <span class="op">=</span> joblib.load(<span class="st">"../Prediction/models/random_forest.joblib"</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>rfc.set_params(random_forest__verbose <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="28">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[('predictors',
                 ColumnTransformer(transformers=[('predictors', 'passthrough',
                                                  ['p1_char.kingkrool',
                                                   'p1_char.hero',
                                                   'p2_char.sonic',
                                                   "stage.Yoshi's Story",
                                                   'stage.Super Mario Maker',
                                                   'stage.Mushroom Kingdom',
                                                   'p2_char.inkling',
                                                   'p1_char.samus',
                                                   'p2_char.mario',
                                                   'p2_char.younglink',
                                                   'p2_char.kingdedede',
                                                   'p2_char.random',
                                                   'stage.Venom',
                                                   'p1_char.bowser',...
                                                   'p2_char.minmin',
                                                   'stage.Norfair',
                                                   'p1_char.sheik',
                                                   'p1_char.steve',
                                                   'stage.Unova Pokemon League',
                                                   'p1_char.ness',
                                                   'p1_char.ike',
                                                   'p2_char.lucas',
                                                   'p2_char.villager',
                                                   'stage.Town and City',
                                                   'p2_char.wario',
                                                   'p2_char.piranhaplant',
                                                   'p1_char.robin',
                                                   'p2_char.wolf', ...])])),
                ('random_forest',
                 RandomForestClassifier(min_samples_leaf=3, n_estimators=200,
                                        n_jobs=4, random_state=420))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox"><label for="sk-estimator-id-6" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('predictors',
                 ColumnTransformer(transformers=[('predictors', 'passthrough',
                                                  ['p1_char.kingkrool',
                                                   'p1_char.hero',
                                                   'p2_char.sonic',
                                                   "stage.Yoshi's Story",
                                                   'stage.Super Mario Maker',
                                                   'stage.Mushroom Kingdom',
                                                   'p2_char.inkling',
                                                   'p1_char.samus',
                                                   'p2_char.mario',
                                                   'p2_char.younglink',
                                                   'p2_char.kingdedede',
                                                   'p2_char.random',
                                                   'stage.Venom',
                                                   'p1_char.bowser',...
                                                   'p2_char.minmin',
                                                   'stage.Norfair',
                                                   'p1_char.sheik',
                                                   'p1_char.steve',
                                                   'stage.Unova Pokemon League',
                                                   'p1_char.ness',
                                                   'p1_char.ike',
                                                   'p2_char.lucas',
                                                   'p2_char.villager',
                                                   'stage.Town and City',
                                                   'p2_char.wario',
                                                   'p2_char.piranhaplant',
                                                   'p1_char.robin',
                                                   'p2_char.wolf', ...])])),
                ('random_forest',
                 RandomForestClassifier(min_samples_leaf=3, n_estimators=200,
                                        n_jobs=4, random_state=420))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox"><label for="sk-estimator-id-7" class="sk-toggleable__label sk-toggleable__label-arrow">predictors: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('predictors', 'passthrough',
                                 ['p1_char.kingkrool', 'p1_char.hero',
                                  'p2_char.sonic', "stage.Yoshi's Story",
                                  'stage.Super Mario Maker',
                                  'stage.Mushroom Kingdom', 'p2_char.inkling',
                                  'p1_char.samus', 'p2_char.mario',
                                  'p2_char.younglink', 'p2_char.kingdedede',
                                  'p2_char.random', 'stage.Venom',
                                  'p1_char.bowser', 'p1_char.zerosuitsamus',
                                  'p2_char.miigunner', 'p2_char.minmin',
                                  'stage.Norfair', 'p1_char.sheik',
                                  'p1_char.steve', 'stage.Unova Pokemon League',
                                  'p1_char.ness', 'p1_char.ike',
                                  'p2_char.lucas', 'p2_char.villager',
                                  'stage.Town and City', 'p2_char.wario',
                                  'p2_char.piranhaplant', 'p1_char.robin',
                                  'p2_char.wolf', ...])])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox"><label for="sk-estimator-id-8" class="sk-toggleable__label sk-toggleable__label-arrow">predictors</label><div class="sk-toggleable__content"><pre>['p1_char.kingkrool', 'p1_char.hero', 'p2_char.sonic', "stage.Yoshi's Story", 'stage.Super Mario Maker', 'stage.Mushroom Kingdom', 'p2_char.inkling', 'p1_char.samus', 'p2_char.mario', 'p2_char.younglink', 'p2_char.kingdedede', 'p2_char.random', 'stage.Venom', 'p1_char.bowser', 'p1_char.zerosuitsamus', 'p2_char.miigunner', 'p2_char.minmin', 'stage.Norfair', 'p1_char.sheik', 'p1_char.steve', 'stage.Unova Pokemon League', 'p1_char.ness', 'p1_char.ike', 'p2_char.lucas', 'p2_char.villager', 'stage.Town and City', 'p2_char.wario', 'p2_char.piranhaplant', 'p1_char.robin', 'p2_char.wolf', 'p1_char.darkpit', 'p2_char.chrom', 'p2_char.yoshi', 'p1_char.pichu', 'p1_char.wolf', 'p2_char.pacman', 'stage.Battlefield', 'p2_char.wiifittrainer', 'stage.Reset Bomb Forest', 'p1_games_played', 'p2_char.sephiroth', 'p2_char.rosalina', 'stage.Brinstar Depths', 'stage.Spirit Train', "stage.Yoshi's Island (Melee)", 'p1_games_won', 'p2_char.kirby', 'p2_char.snake', 'p2_char.-1', 'p1_char.yoshi', 'p2_char.pit', 'p2_char.samus', 'p2_char.peach', 'p2_char.sheik', 'stage.Kalos Pokémon League', 'stage.Eldin Bridge', 'p2_char.ness', 'p1_char.-1', 'stage.Mute City SNES', 'p2_char.banjokazooie', 'p2_char.bowserjr', 'stage.Unova Pokémon League', 'p1_char.mario', 'p2_char.pikachu', 'p1_char.miibrawler', 'p2_char.donkeykong', 'p2_char.lucario', 'stage.New Donk City Hall', 'p2_char.ken', 'p2_char.ridley', 'stage.Hyrule Castle', 'stage.Small Battlefield', 'p2_char.kingkrool', 'p2_char.metaknight', 'p2_char.simon', 'p1_char.miigunner', 'p1_char.pikachu', 'stage.-1', 'p1_char.jigglypuff', 'p1_char.drmario', 'p1_char.captainfalcon', 'p1_char.lucina', 'p1_char.darksamus', 'p1_char.byleth', 'p1_char.mewtwo', 'p1_char.littlemac', 'stage.Hollow Bastion', 'p2_char.corrin', 'p2_char.diddykong', 'stage.Lylat Cruise', 'p2_char.olimar', 'stage.Final Destination', 'p2_char.incineroar', 'stage.Magicant', 'p2_char.lucina', 'stage.WarioWare', 'p2_char.byleth', 'p2_char.pichu', 'p1_char.pacman', 'p1_char.sonic', 'p1_char.cloud', 'stage.Kalos Pokemon League', 'stage.Saffron City', 'p1_char.simon', 'p1_char.random', 'p1_char.sephiroth', 'stage.Wily Castle', 'stage.Mario Circuit', 'p2_char.luigi', 'p2_char.toonlink', 'p2_char.fox', 'p2_char.ike', 'p2_char.steve', 'p1_char.corrin', 'p2_char.bowser', 'p2_char.ryu', 'p1_char.minmin', 'p2_char.jigglypuff', 'stage.Town &amp; City', 'p1_char.kazuya', 'p1_char.donkeykong', 'p2_char.zelda', 'p2_char.mewtwo', 'p2_char.marth', 'p2_char.cloud', 'p1_char.metaknight', 'stage.Corneria', 'p1_char.rob', 'p2_games_played', 'stage.Distant Planet', 'p1_char.luigi', 'stage.Pokémon Stadium 2', 'p1_char.megaman', 'p2_char.roy', 'p2_char.mrgameandwatch', 'stage.Pokemon Stadium 2', 'p1_char.mrgameandwatch', 'stage.Mario Galaxy', 'p1_char.daisy', 'p1_char.ryu', 'p1_char.villager', 'p1_char.olimar', 'stage.Pokémon Stadium', 'p1_char.inkling', 'p1_char.chrom', 'p2_char.joker', 'p2_char.megaman', 'p1_char.roy', 'p2_games_won', "stage.Yoshi's Island", 'p2_char.darkpit', 'p1_char.link', 'stage.Frigate Orpheon', 'p2_char.bayonetta', 'p1_char.lucas', 'p1_char.rosalina', 'p2_char.hero', 'stage.Moray Towers', 'p1_char.isabelle', 'stage.Balloon Fight', 'p2_char.darksamus', 'p2_char.miiswordfighter', 'p1_char.ken', 'p2_char.captainfalcon', 'p1_char.fox', 'p2_char.duckhunt', 'p1_char.incineroar', 'p1_char.toonlink', 'p2_char.littlemac', 'stage.Dream Land', 'p1_char.kirby', 'p1_char.greninja', 'stage.Smashville', 'p1_char.peach', 'p1_char.piranhaplant', 'p2_char.pokemontrainer', 'p2_char.zerosuitsamus', 'p1_char.duckhunt', 'stage.Pilotwings', 'p2_char.link', 'p2_char.sora', 'p2_char.daisy', 'p2_char.pyra', 'p2_char.ganondorf', 'p2_char.rob', 'stage.Mementos', "stage.Yggdrasil's Altar", 'p1_char.diddykong', "stage.Luigi's Mansion", 'stage.Duck Hunt', 'p2_char.drmario', 'p1_char.palutena', 'p2_char.iceclimbers', 'p1_char.marth', 'stage.Northern Cave', 'p1_char.sora', 'p2_char.kazuya', 'p2_char.isabelle', 'p1_char.joker', 'p1_char.pokemontrainer', 'stage.Green Greens', 'p1_char.shulk', 'p1_char.wario', 'p1_char.ridley', 'p1_char.lucario', 'stage.Skyloft', 'p2_char.terry', 'p2_char.shulk', 'p2_char.robin', 'p2_char.greninja', 'p1_char.richter', 'stage.Castle Siege', 'p1_char.bayonetta', 'p1_char.younglink', 'p2_char.falco', 'p1_char.falco', 'p1_char.terry', 'p1_char.bowserjr', 'p1_char.iceclimbers', 'p1_char.wiifittrainer', 'stage.Fountain of Dreams', 'p2_char.richter', 'p1_char.pyra', 'p1_char.zelda', 'p2_char.miibrawler', 'p1_char.ganondorf', 'p1_char.banjokazooie', 'stage.Boxing Ring', 'p1_char.snake', 'p2_char.palutena', 'stage.Find Mii', 'p1_char.kingdedede', 'p1_char.pit', 'p1_char.miiswordfighter']</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox"><label for="sk-estimator-id-9" class="sk-toggleable__label sk-toggleable__label-arrow">passthrough</label><div class="sk-toggleable__content"><pre>passthrough</pre></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox"><label for="sk-estimator-id-10" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(min_samples_leaf=3, n_estimators=200, n_jobs=4,
                       random_state=420)</pre></div></div></div></div></div></div></div>
</div>
</div>
<section id="metrics-1" class="level3">
<h3 class="anchored" data-anchor-id="metrics-1">Metrics</h3>
<p>Let’s display our test <code>roc_auc</code> and <code>accuracy</code>.</p>
<div class="cell" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_metrics(model):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">=</span> model.predict(X_test)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    actual <span class="op">=</span> y_test</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Metrics for </span><span class="sc">{model}</span><span class="ch">\n</span><span class="st">"</span>.<span class="bu">format</span>(model<span class="op">=</span>model[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Accuracy: </span><span class="sc">%0.4f</span><span class="st">"</span> <span class="op">%</span> accuracy_score(prediction,actual))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"ROC_AUC: </span><span class="sc">%0.4f</span><span class="st">"</span> <span class="op">%</span> roc_auc_score(prediction,actual))</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>get_metrics(en)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>get_metrics(rfc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Metrics for LogisticRegression(C=0.01, l1_ratio=1.0, penalty='elasticnet', solver='saga')

Accuracy: 0.6432
ROC_AUC: 0.6432

</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Metrics for RandomForestClassifier(min_samples_leaf=3, n_estimators=200, n_jobs=4,
                       random_state=420)

Accuracy: 0.6782
ROC_AUC: 0.6782

</code></pre>
</div>
</div>
<p>Interestingly, the <code>roc_auc</code> and <code>accuracy</code> is the same for both our models. This is likely because there is no class imabalance present, which further justifies our decision to use accuracy as a scoring metric in our hyperparameter tuning.</p>
<p>The elastic net got an accuracy of 0.6434, and the random forest got an accuracy of 0.6782.</p>
</section>
<section id="variable-importance" class="level3">
<h3 class="anchored" data-anchor-id="variable-importance">Variable Importance</h3>
<p>I want to find the variable importance of the predictors in my random forest so I can make some statements about how certain varaibles affect outcome.</p>
<p>Here is a table of the most important variables in the RFC:</p>
<div class="cell" data-execution_count="28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> rfc[<span class="op">-</span><span class="dv">1</span>].feature_importances_</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> rfc[<span class="st">"predictors"</span>].transformers_[<span class="dv">0</span>][<span class="dv">2</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>importanceDF <span class="op">=</span> pd.DataFrame([importances,feature_names]).transpose()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>importanceDF.columns <span class="op">=</span> [<span class="st">"importance"</span>,<span class="st">"feature name"</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>importanceDF.sort_values(by<span class="op">=</span><span class="st">"importance"</span>,ascending<span class="op">=</span> <span class="va">False</span>).head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>importance</th>
      <th>feature name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>148</th>
      <td>0.190556</td>
      <td>p2_games_won</td>
    </tr>
    <tr>
      <th>45</th>
      <td>0.189577</td>
      <td>p1_games_won</td>
    </tr>
    <tr>
      <th>39</th>
      <td>0.14731</td>
      <td>p1_games_played</td>
    </tr>
    <tr>
      <th>128</th>
      <td>0.145371</td>
      <td>p2_games_played</td>
    </tr>
    <tr>
      <th>131</th>
      <td>0.007244</td>
      <td>stage.Pokémon Stadium 2</td>
    </tr>
    <tr>
      <th>118</th>
      <td>0.005352</td>
      <td>stage.Town &amp; City</td>
    </tr>
    <tr>
      <th>77</th>
      <td>0.005285</td>
      <td>stage.-1</td>
    </tr>
    <tr>
      <th>91</th>
      <td>0.005256</td>
      <td>stage.Final Destination</td>
    </tr>
    <tr>
      <th>172</th>
      <td>0.005113</td>
      <td>stage.Smashville</td>
    </tr>
    <tr>
      <th>36</th>
      <td>0.005108</td>
      <td>stage.Battlefield</td>
    </tr>
    <tr>
      <th>54</th>
      <td>0.004008</td>
      <td>stage.Kalos Pokémon League</td>
    </tr>
    <tr>
      <th>71</th>
      <td>0.003919</td>
      <td>stage.Small Battlefield</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.002982</td>
      <td>p1_char.bowser</td>
    </tr>
    <tr>
      <th>114</th>
      <td>0.002981</td>
      <td>p2_char.bowser</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.002968</td>
      <td>p1_char.ness</td>
    </tr>
    <tr>
      <th>56</th>
      <td>0.002955</td>
      <td>p2_char.ness</td>
    </tr>
    <tr>
      <th>124</th>
      <td>0.002873</td>
      <td>p2_char.cloud</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.002843</td>
      <td>stage.Yoshi's Story</td>
    </tr>
    <tr>
      <th>191</th>
      <td>0.002786</td>
      <td>p1_char.palutena</td>
    </tr>
    <tr>
      <th>199</th>
      <td>0.002765</td>
      <td>p1_char.pokemontrainer</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>To no suprise, the most important predictors are <code>games played</code> and <code>games won</code> for both players. However what is interesting is that the next 8 most important predictors are stage, and only then do we see character data.</p>
<p>I suspect that stage is an important predictor not because of the stage itself, but because of the kinds of tournaments associated with these stages. To preface, the following speculation based on anecdote. I would suspect Pokemon Stadium 2, Town &amp; City, Final Destination, Battlefield, ect. all come up as the most important stages associated with predictive power because these stages are often used in high-level tournaments. If you watch competitive smash, these are the kinds of stages you see top players playing on. This is likely just by preference and standarization in the Smash community, however we see that this preference shows up in our model, which is an interesting result.</p>
<p>Now, I want to look at how character data affects the outcome.</p>
<div class="cell" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>importanceDF[importanceDF[<span class="st">"feature name"</span>].<span class="bu">str</span>.contains(<span class="st">"char"</span>)].sort_values(by<span class="op">=</span><span class="st">"importance"</span>,ascending<span class="op">=</span> <span class="va">False</span>).head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>importance</th>
      <th>feature name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>0.002982</td>
      <td>p1_char.bowser</td>
    </tr>
    <tr>
      <th>114</th>
      <td>0.002981</td>
      <td>p2_char.bowser</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.002968</td>
      <td>p1_char.ness</td>
    </tr>
    <tr>
      <th>56</th>
      <td>0.002955</td>
      <td>p2_char.ness</td>
    </tr>
    <tr>
      <th>124</th>
      <td>0.002873</td>
      <td>p2_char.cloud</td>
    </tr>
    <tr>
      <th>191</th>
      <td>0.002786</td>
      <td>p1_char.palutena</td>
    </tr>
    <tr>
      <th>199</th>
      <td>0.002765</td>
      <td>p1_char.pokemontrainer</td>
    </tr>
    <tr>
      <th>229</th>
      <td>0.002756</td>
      <td>p2_char.palutena</td>
    </tr>
    <tr>
      <th>100</th>
      <td>0.002754</td>
      <td>p1_char.cloud</td>
    </tr>
    <tr>
      <th>175</th>
      <td>0.002706</td>
      <td>p2_char.pokemontrainer</td>
    </tr>
    <tr>
      <th>29</th>
      <td>0.002688</td>
      <td>p2_char.wolf</td>
    </tr>
    <tr>
      <th>34</th>
      <td>0.002631</td>
      <td>p1_char.wolf</td>
    </tr>
    <tr>
      <th>32</th>
      <td>0.00253</td>
      <td>p2_char.yoshi</td>
    </tr>
    <tr>
      <th>49</th>
      <td>0.002528</td>
      <td>p1_char.yoshi</td>
    </tr>
    <tr>
      <th>143</th>
      <td>0.002469</td>
      <td>p1_char.inkling</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.002466</td>
      <td>p2_char.inkling</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.002453</td>
      <td>p2_char.mario</td>
    </tr>
    <tr>
      <th>120</th>
      <td>0.002423</td>
      <td>p1_char.donkeykong</td>
    </tr>
    <tr>
      <th>62</th>
      <td>0.002402</td>
      <td>p1_char.mario</td>
    </tr>
    <tr>
      <th>65</th>
      <td>0.002393</td>
      <td>p2_char.donkeykong</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>In most cases, we wee that if <code>p1_char</code> and <code>p2_char</code> are the same character, they have a similar importance. This is a good thing because we would expect our model to be symmetric, in that, the outcome shouldn’t matter based on who is the first player or the second player.</p>
<p>We see names like <code>Bowser</code>, <code>Ness</code>, <code>Palutena</code>, <code>Wolf</code>, <code>Yoshi</code>, and more come up first.</p>
<p>Because this only shows how important the variables are and not their relationship to the outcome, it is not possible to tell whether showing up at the top means a character is favorable or unfavorable. However, it is interesting to see which characters yeild the most predictive power.</p>
<p>If we want to interpret this, we might say that characters towards the top are the least balanced (for their benefit or detriment), and characters towards the bottom are the most balanced. Let’s see which characters have the least predictive power.</p>
<div class="cell" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>importanceDF[importanceDF[<span class="st">"feature name"</span>].<span class="bu">str</span>.contains(<span class="st">"char"</span>)].sort_values(by<span class="op">=</span><span class="st">"importance"</span>,ascending<span class="op">=</span> <span class="va">False</span>).tail(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="32">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>importance</th>
      <th>feature name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>73</th>
      <td>0.000838</td>
      <td>p2_char.metaknight</td>
    </tr>
    <tr>
      <th>66</th>
      <td>0.000836</td>
      <td>p2_char.lucario</td>
    </tr>
    <tr>
      <th>125</th>
      <td>0.000834</td>
      <td>p1_char.metaknight</td>
    </tr>
    <tr>
      <th>75</th>
      <td>0.000825</td>
      <td>p1_char.miigunner</td>
    </tr>
    <tr>
      <th>161</th>
      <td>0.000797</td>
      <td>p2_char.miiswordfighter</td>
    </tr>
    <tr>
      <th>115</th>
      <td>0.000778</td>
      <td>p2_char.ryu</td>
    </tr>
    <tr>
      <th>139</th>
      <td>0.00076</td>
      <td>p1_char.ryu</td>
    </tr>
    <tr>
      <th>233</th>
      <td>0.00076</td>
      <td>p1_char.miiswordfighter</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.000731</td>
      <td>p1_char.sheik</td>
    </tr>
    <tr>
      <th>53</th>
      <td>0.000718</td>
      <td>p2_char.sheik</td>
    </tr>
    <tr>
      <th>41</th>
      <td>0.000712</td>
      <td>p2_char.rosalina</td>
    </tr>
    <tr>
      <th>155</th>
      <td>0.000703</td>
      <td>p1_char.rosalina</td>
    </tr>
    <tr>
      <th>90</th>
      <td>0.000659</td>
      <td>p2_char.olimar</td>
    </tr>
    <tr>
      <th>141</th>
      <td>0.000657</td>
      <td>p1_char.olimar</td>
    </tr>
    <tr>
      <th>232</th>
      <td>0.000593</td>
      <td>p1_char.pit</td>
    </tr>
    <tr>
      <th>50</th>
      <td>0.000575</td>
      <td>p2_char.pit</td>
    </tr>
    <tr>
      <th>103</th>
      <td>0.000513</td>
      <td>p1_char.simon</td>
    </tr>
    <tr>
      <th>74</th>
      <td>0.000481</td>
      <td>p2_char.simon</td>
    </tr>
    <tr>
      <th>181</th>
      <td>0.000481</td>
      <td>p2_char.daisy</td>
    </tr>
    <tr>
      <th>138</th>
      <td>0.000478</td>
      <td>p1_char.daisy</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The mii characters show up near the bottom of the list, as well as pit, simon, and daisy.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>